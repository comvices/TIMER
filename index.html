<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TIMER By KRUPHRAT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&family=Anuphan:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Anuphan', sans-serif; }
        .timer-font { font-family: 'JetBrains Mono', monospace; }
        
        /* Animation เมื่อเวลาหมด */
        .time-up-active {
            animation: pulse-danger 1.5s infinite;
        }
        @keyframes pulse-danger {
            0%, 100% { background-color: #ffffff; transform: scale(1); }
            50% { background-color: #fee2e2; transform: scale(1.05); }
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        input::-webkit-outer-spin-button, 
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        .transition-all { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 min-h-screen flex items-center justify-center p-4">

    <div id="mainCard" class="glass-card rounded-[2.5rem] p-8 w-full max-w-md shadow-[0_20px_50px_rgba(0,0,0,0.3)] transition-all">
        
        <!-- ส่วนเลือกโหมด -->
        <div class="flex bg-slate-100/80 p-1.5 rounded-2xl mb-8">
            <button onclick="setMode('down')" id="tabDown" class="flex-1 py-2.5 rounded-xl text-sm font-bold transition-all bg-white shadow-sm text-indigo-600">
                นับถอยหลัง
            </button>
            <button onclick="setMode('up')" id="tabUp" class="flex-1 py-2.5 rounded-xl text-sm font-bold transition-all text-slate-500 hover:text-indigo-400">
                นับเดินหน้า
            </button>
        </div>

        <!-- หน้าจอแสดงผล -->
        <div class="relative mb-8">
            <div id="display" class="timer-font text-8xl font-bold text-center text-slate-800 tabular-nums tracking-tighter">
                00:00
            </div>
        </div>

        <div class="space-y-6">
            <!-- ส่วนกรอกเวลา -->
            <div id="inputGroup" class="space-y-4">
                <div class="relative">
                    <label class="block text-center text-slate-400 text-[10px] uppercase tracking-[0.3em] mb-3 font-bold">ระบุเวลา (วินาที)</label>
                    <input type="number" id="durationInput" value="60" 
                        class="w-full bg-slate-50 border-2 border-slate-100 rounded-2xl py-4 text-center text-3xl font-bold outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 transition-all text-slate-700">
                </div>
                
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="addTime(30)" class="py-2 bg-slate-50 hover:bg-slate-100 text-slate-500 text-xs font-bold rounded-lg transition-all">+30 วิ</button>
                    <button onclick="addTime(60)" class="py-2 bg-slate-50 hover:bg-slate-100 text-slate-500 text-xs font-bold rounded-lg transition-all">+1 นาที</button>
                    <button onclick="addTime(300)" class="py-2 bg-slate-50 hover:bg-slate-100 text-slate-500 text-xs font-bold rounded-lg transition-all">+5 นาที</button>
                </div>
            </div>

            <!-- ปุ่มควบคุม -->
            <div class="grid grid-cols-2 gap-4">
                <button onclick="toggleTimer()" id="mainBtn"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-5 rounded-2xl shadow-lg shadow-indigo-200 transition-all active:scale-95 flex items-center justify-center gap-2">
                    <span id="btnIcon">▶</span> <span id="btnText">เริ่มทำงาน</span>
                </button>
                <button onclick="resetTimer()" 
                    class="bg-slate-100 hover:bg-slate-200 text-slate-500 font-bold py-5 rounded-2xl transition-all active:scale-95">
                    เริ่มใหม่
                </button>
            </div>
            
            <p id="audioStatus" class="text-center text-[10px] text-slate-400 uppercase tracking-widest font-bold h-4"></p>
        </div>
    </div>

    <!-- ไฟล์เสียง (ตรวจสอบชื่อไฟล์ให้ตรงกับในเครื่อง) -->
    <audio id="startSound" preload="auto" src="start.mp3"></audio>
    <audio id="endSound" preload="auto" src="END.mp3"></audio>

    <script>
        let timerInterval;
        let remainingTime = 0; // เก็บเวลาปัจจุบันเป็นวินาที
        let isRunning = false;
        let currentMode = 'down';
        let audioUnlocked = false;
        let lastTimestamp = 0;

        const display = document.getElementById('display');
        const mainBtn = document.getElementById('mainBtn');
        const btnText = document.getElementById('btnText');
        const btnIcon = document.getElementById('btnIcon');
        const durationInput = document.getElementById('durationInput');
        const mainCard = document.getElementById('mainCard');
        const startSound = document.getElementById('startSound');
        const endSound = document.getElementById('endSound');

        // ฟังก์ชันเบื้องต้น: ดึงค่าเริ่มต้นมาโชว์
        window.onload = () => {
            remainingTime = parseInt(durationInput.value) || 0;
            updateDisplay(remainingTime);
        };

        function unlockAudio() {
            if (audioUnlocked) return;
            [startSound, endSound].forEach(audio => {
                audio.play().then(() => { audio.pause(); audio.currentTime = 0; }).catch(() => {});
            });
            audioUnlocked = true;
        }

        function setMode(mode) {
            if (isRunning) pauseTimer();
            currentMode = mode;
            
            const isDown = mode === 'down';
            document.getElementById('tabDown').className = isDown ? "flex-1 py-2.5 rounded-xl text-sm font-bold bg-white shadow-sm text-indigo-600 transition-all" : "flex-1 py-2.5 rounded-xl text-sm font-bold text-slate-500 hover:text-indigo-400 transition-all";
            document.getElementById('tabUp').className = !isDown ? "flex-1 py-2.5 rounded-xl text-sm font-bold bg-white shadow-sm text-indigo-600 transition-all" : "flex-1 py-2.5 rounded-xl text-sm font-bold text-slate-500 hover:text-indigo-400 transition-all";
            document.getElementById('inputGroup').style.display = isDown ? 'block' : 'none';
            
            resetTimer();
        }

        function addTime(seconds) {
            const currentVal = parseInt(durationInput.value) || 0;
            durationInput.value = currentVal + seconds;
            if (!isRunning && currentMode === 'down') {
                remainingTime = parseInt(durationInput.value);
                updateDisplay(remainingTime);
            }
        }

        function updateDisplay(totalSeconds) {
            const mins = Math.floor(Math.abs(totalSeconds) / 60);
            const secs = Math.abs(totalSeconds) % 60;
            display.innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            
            if (currentMode === 'down' && totalSeconds <= 10 && totalSeconds > 0) {
                display.classList.add('text-rose-500');
            } else {
                display.classList.remove('text-rose-500');
            }
        }

        function toggleTimer() {
            unlockAudio();
            if (isRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        }

        function startTimer() {
            // กรณีเริ่มใหม่จาก 0 ในโหมดนับถอยหลัง
            if (currentMode === 'down' && remainingTime <= 0) {
                remainingTime = parseInt(durationInput.value) || 0;
                if (remainingTime <= 0) return alert("กรุณาระบุเวลา");
            }

            isRunning = true;
            updateButtonUI(true);
            mainCard.classList.remove('time-up-active');
            
            startSound.currentTime = 0;
            startSound.play().catch(() => {});

            lastTimestamp = Date.now();

            timerInterval = setInterval(() => {
                const now = Date.now();
                const deltaTime = Math.floor((now - lastTimestamp) / 1000);

                if (deltaTime >= 1) {
                    if (currentMode === 'down') {
                        remainingTime -= deltaTime;
                        if (remainingTime <= 0) {
                            remainingTime = 0;
                            finishTimer();
                        }
                    } else {
                        remainingTime += deltaTime;
                    }
                    lastTimestamp = now;
                    updateDisplay(remainingTime);
                }
            }, 100);
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            updateButtonUI(false);
        }

        function finishTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            updateDisplay(0);
            endSound.currentTime = 0;
            endSound.play().catch(() => {});
            mainCard.classList.add('time-up-active');
            updateButtonUI(false);
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            mainCard.classList.remove('time-up-active');
            
            if (currentMode === 'down') {
                remainingTime = parseInt(durationInput.value) || 0;
            } else {
                remainingTime = 0;
            }
            
            updateDisplay(remainingTime);
            updateButtonUI(false);
        }

        function updateButtonUI(running) {
            if (running) {
                btnText.innerText = "หยุดชั่วคราว";
                btnIcon.innerText = "⏸";
                mainBtn.classList.replace('bg-indigo-600', 'bg-rose-500');
            } else {
                btnText.innerText = (remainingTime > 0 && currentMode === 'down') ? "ทำต่อ" : "เริ่มทำงาน";
                btnIcon.innerText = "▶";
                mainBtn.classList.replace('bg-rose-500', 'bg-indigo-600');
            }
        }

        durationInput.addEventListener('input', () => {
            if (!isRunning && currentMode === 'down') {
                remainingTime = parseInt(durationInput.value) || 0;
                updateDisplay(remainingTime);
            }
        });
    </script>
</body>
</html>